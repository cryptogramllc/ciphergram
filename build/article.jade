doctype html
include ./includes/head.jade
- var pageTitle = "Blog Post | Ciphergram - Cybersecurity & Technology Insights"
- var pageDescription = "Read the latest blog post from Ciphergram covering cybersecurity, software development, AI, and IT consulting insights. Expert analysis and industry best practices."
- var canonicalUrl = "/article"
- var currentPage = 'article'
body
    // LOADER
    #loader-overflow
        #loader3 Please enable JS
    #wrap.boxed
        .grey-bg
            // Grey BG
            //if lte IE 8
                #ie-container
                    #ie-cont-close
                        a(href='#', onclick='javascript:this.parentNode.parentNode.style.display="none"; return false;')
                            img(src='images/ie-warn/ie-warning-close.jpg', style='border: none;', alt='Close')
                    #ie-cont-content
                        #ie-cont-warning
                            img(src='images/ie-warn/ie-warning.jpg', alt='Warning!')
                        #ie-cont-text
                            #ie-text-bold
                            #ie-text
                        #ie-cont-brows
                            a(href='http://www.firefox.com', target='_blank')
                                img(src='images/ie-warn/ie-warning-firefox.jpg', alt='Download Firefox')
                            a(href='http://www.opera.com/download/', target='_blank')
                                img(src='images/ie-warn/ie-warning-opera.jpg', alt='Download Opera')
                            a(href='http://www.apple.com/safari/download/', target='_blank')
                                img(src='images/ie-warn/ie-warning-safari.jpg', alt='Download Safari')
                            a(href='http://www.google.com/chrome', target='_blank')
                                img(src='images/ie-warn/ie-warning-chrome.jpg', alt='Download Google Chrome')
            // HEADER 1 BLACK MOBILE-NO-TRANSPARENT
            include ./includes/header.jade
    #blog.page-section.p-140-cont
      .container
        .row
          .col-md-12
            .row
              .col-md-12.col-sm-12
                .fes4-box.wow.fadeIn(data-wow-delay='200ms')
                  h2.section-title
                    span.bold.title Blog Post
                    span.bold.right.small.date
            .row
              .col-md-12.col-sm-12.pb-10
                .fes5-box.wow.fadeIn(data-wow-delay='200ms')
                  .main-content
                    p Loading blog post content...
    include ./includes/footer.jade
include ./includes/scripts/article-js.jade
script.
    $(document).ready(function() {
        function getBlogUUIDFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('uuid');
        }
        
        function fetchBlogPost(uuid) {
            return new Promise((resolve, reject) => {
                const url = `https://h38fikktw7.execute-api.us-east-1.amazonaws.com/prod/items/${uuid}`;
                
                $.ajax({
                    url: url, 
                    method: 'GET',
                    dataType: 'json',
                    success: function(data) {
                        resolve(data);
                    },
                    error: function(xhr, status, error) {
                        console.error('API request failed:', error);
                        reject(error);
                    }
                });
            });
        }

        async function loadBlogPost() {
            try {
                const uuid = getBlogUUIDFromURL();
                
                if (!uuid) {
                    // If no valid uuid, redirect to blog index
                    window.location.href = '/blog';
                    return;
                }
                
                const response = await fetchBlogPost(uuid);
                
                if (response && response.title) {
                    // Update page title and meta tags
                    document.title = `${response.title} | Ciphergram Blog`;
                    
                    // Update meta description
                    const metaDescription = response.content ? response.content.substring(0, 160) + '...' : 'Read the latest blog post from Ciphergram covering cybersecurity, software development, AI, and IT consulting insights.';
                    $('meta[name="description"]').attr('content', metaDescription);
                    
                    // Update Open Graph tags
                    $('meta[property="og:title"]').attr('content', `${response.title} | Ciphergram Blog`);
                    $('meta[property="og:description"]').attr('content', metaDescription);
                    if (response.image) {
                        $('meta[property="og:image"]').attr('content', response.image);
                    }
                    
                    // Update Twitter Card tags
                    $('meta[name="twitter:title"]').attr('content', `${response.title} | Ciphergram Blog`);
                    $('meta[name="twitter:description"]').attr('content', metaDescription);
                    if (response.image) {
                        $('meta[name="twitter:image"]').attr('content', response.image);
                    }
                    
                    // Update content
                    $('h2.section-title span.title').html(response.title);
                    $('h2.section-title span.date').html(response.date || '');
                    
                    // Update main content
                    let content = '';
                    if (response.image) {
                        content += `<div class="blog-post-image" style="background-image: url(${response.image}); height: 400px; background-size: cover; background-position: center; margin-bottom: 30px; border-radius: 8px;"></div>`;
                    }
                    content += `<div class="blog-post-content">${response.content || 'Content not available.'}</div>`;
                    
                    $('.main-content').html(content);
                } else {
                    // Show error message
                    $('h2.section-title span.title').html('Blog Post Not Found');
                    $('h2.section-title span.date').html('');
                    $('.main-content').html(`
                        <div class="blog-error">
                            <h3>Sorry, this blog post could not be found.</h3>
                            <p>The requested blog post may have been moved or deleted.</p>
                            <p><a href="/blog" class="btn btn-md btn-color">← Back to Blog</a></p>
                        </div>
                    `);
                }
            } catch (error) {
                console.error('Error loading blog post:', error);
                // Show error message
                $('h2.section-title span.title').html('Error Loading Post');
                $('h2.section-title span.date').html('');
                $('.main-content').html(`
                    <div class="blog-error">
                        <h3>Sorry, there was an error loading this blog post.</h3>
                        <p>Please try again later or <a href="/blog">return to the blog</a>.</p>
                        <p><a href="/blog" class="btn btn-md btn-color">← Back to Blog</a></p>
                    </div>
                `);
            }
        }

        // Load blog post content
        loadBlogPost();
    });
